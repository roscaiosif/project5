jQuery(function(a){"use strict";function b(){var b="food",c="200",d="JI2X04M51STQLOUGVX0SWEOOSOOSHB2BEMZ0QTPM02TMJGGX",e="4W4IRQJ10E0HKFLK4TFX3KZ4Q25DHQMFKH0IQEYFRG3XDQXQ",f="https://api.foursquare.com/v2/venues/explore?client_id=";f+=d+"&client_secret=",f+=e+"&v=20150704&ll=",f+=i+",",f+=j+"&radius=",f+=c+"&section=",f+=b+"&limit=50";var g=function(b){function c(a){var c={};c.prefix=a.prefix,c.suffix=a.suffix,c.width=a.width,c.height=a.height,b.photos.push(c)}var f="https://api.foursquare.com/v2/venues/";f+=b.id+"/photos?client_id=",f+=d+"&client_secret=",f+=e+"&v=20150704",a.ajax({url:f,success:function(a){var d=a.response.photos.count;if(d=10>d?d:10,b.photoCount=d,d>0)for(var e=a.response.photos.items,f=0;d>f;f++)c(e[f]);else b.photos.push(u)},error:function(b){var c=a.parseJSON(b.responseText);successDetailData=!1,q("Server response: <em>"+c.meta.errorDetail+"</em>")}})},h=function(b){a.ajax({url:b,success:function(b){var c=b.response.groups[0].items;v.myVenues(ko.utils.arrayMap(c,function(a){return new v.Venue(a)}));for(var d=0,e=v.myVenues().length;e>d;d++){var f=v.myVenues()[d];g(f),f.mapMarker=k(f);var h=f.category;-1===a.inArray(h,v.categories())&&v.categories.push(h),v.categories.sort()}},error:function(b){successMainData=!1;var c=a.parseJSON(b.responseText);q("Server response: <em>"+c.meta.errorDetail+"</em>")}})},k=function(a){var b=new google.maps.LatLng(a.lat,a.lng),c=new google.maps.Marker({map:m,position:b,icon:a.icon.prefix+"bg_32"+a.icon.suffix});return google.maps.event.addListener(c,"click",function(){r(a)}),c};h(f)}function c(){function b(b){e=a("#map-canvas").width(),f=a("#map-canvas").height();var c=.5;e>=1024?c=.25:e>=768?c=.3:e>=414&&(c=.4);var d=Math.floor(e*c),g=Math.floor(d/1.5),h=d+"x"+g;return n.setOptions({maxWidth:d}),h}var c=this;c.myVenues=ko.observableArray(),c.crtVenue=ko.observable(),c.categories=ko.observableArray(),c.selectedCategories=ko.observableArray(),c.selectedAllCategories=ko.observable(!0),c.Venue=function(a){var b=this;if(b.icon={},b.crtPhoto=0,b.photoCount=0,b.photos=[],void 0!==a){var c=a.venue,d=c.categories[0],e=c.location;b.id=c.id,b.lat=e.lat,b.lng=e.lng,b.address=e.formattedAddress,b.category=d.shortName,b.icon.prefix=d.icon.prefix,b.icon.suffix=d.icon.suffix,b.description=a.tips[0].text,b.name=c.name,b.url=c.url}else b.description="",b.photos=[u],b.name="",b.url=void 0,b.address=[],b.address[0]=void 0,b.address[1]=void 0,b.category="";b.mapMarker={},b.isCategoryVisible=ko.observable(!0),b.isQueryVisible=ko.observable(!0),b.isVisible=ko.computed(function(){return b.isCategoryVisible()&&b.isQueryVisible()})},c.crtVenue(new c.Venue(void 0)),c.query=ko.observable("");var d=function(a){a.isCategoryVisible(!0),a.isQueryVisible(!0),a.mapMarker.setVisible(!0)},g=function(a){a.isCategoryVisible(!1),a.mapMarker.setVisible(!1)},h=function(b){a.each(c.myVenues(),function(a,c){b?g(c):d(c)})},i=function(a,b){0===a?q('No venues found for: <em>"'+c.query()+'"</em>'):(o.close(),1===a&&r(c.myVenues()[b])),a>1&&n.close()};c.showCrtPhoto=function(){var a=c.crtVenue(),d="";if(void 0!==a){var e=a.crtPhoto===a.photoCount?0:a.crtPhoto;if(d=a.photos[e].prefix,""!==a.photos[e].suffix){var f=b(a.photos[e]);d+=f+a.photos[e].suffix,e++,a.crtPhoto=e}}return d},c.toggleSelectAll=function(){return h(c.selectedAllCategories()?!1:!0),c.query(""),!0},c.showVenuesWithSelectedCategories=function(){var b=c.myVenues(),e=c.selectedCategories();c.query(""),c.selectedAllCategories()&&c.selectedAllCategories(!1);for(var f=0,h=0,j=0;j<b.length;j++)a.inArray(b[j].category,e)>-1?(d(b[j]),f++,h=j):g(b[j]);i(f,h)},c.venueListClick=function(a){r(a)},c.showSelectedByQuery=function(){for(var a=c.query().toLowerCase(),b=0,d=0,e=c.myVenues(),f=0;f<e.length;f++)if(e[f].isCategoryVisible()){var g=e[f].name.toLowerCase();0===g.indexOf(a)?(e[f].isQueryVisible(!0),e[f].mapMarker.setVisible(!0),b++,d=f):(e[f].isQueryVisible(!1),e[f].mapMarker.setVisible(!1))}i(b,d)},c.hideSearchFilterButton=function(){a("#search-filter").removeClass("hide"),a("#btn-search-filter").addClass("hide"),n.close()},c.hideListButton=function(){a("#list-wrapper").removeClass("hide").css("height","75px"),a("#map-wrapper").css("height","height: calc(100% - 80px)"),a("#btn-list").addClass("hide")}}var d=a("#map-canvas"),e=a("#map-canvas").width(),f=a("#map-canvas").height(),g=680,h=400,i=45.4960301,j=-73.5789544,k=new google.maps.LatLng(i,j),l={zoom:17,center:k,mapTypeId:google.maps.MapTypeId.ROADMAP},m=new google.maps.Map(d[0],l);google.maps.event.addDomListener(window,"resize",function(){google.maps.event.trigger(m,"resize"),m.setCenter(k)});var n=(m.getStreetView(),new google.maps.InfoWindow),o=new google.maps.InfoWindow,p=new google.maps.Marker({map:m,position:k});p.setVisible(!1);var q=function(b){a("#error-message").html(b),o.setContent(a("#error-window").html()),o.open(m,p),n.close()},r=function(b){var c=b.mapMarker;v.crtVenue(b);var d=a("#img-wrapper");a("#info-window").find("img").on("load",function(){d.hasClass("hide")&&d.removeClass("hide"),n.setContent(a("#info-window").html())}).on("error",function(){d.addClass("hide"),a("#img-error").html("<h3>The Internet connetion was lost...</h3>")}),m.panTo(c.getPosition()),g>e?m.panBy(0,-100):m.panBy(0,-50),a("#btn-search-filter").hasClass("hide")&&g>e&&s(),a("#btn-list").hasClass("hide")&&h>f&&t(),n.open(m,c)},s=function(){a("#search-filter").addClass("hide"),a("#btn-search-filter").removeClass("hide")},t=function(){a("#list-wrapper").addClass("hide").css("height",0),a("#map-wrapper").css("height","100%"),a("#btn-list").removeClass("hide")},u={prefix:"images/dist/foursquare-wordmark.png",suffix:"",width:0,height:0},v=new c;window.VM=v,window.errorwindow=o,ko.applyBindings(v),b()});