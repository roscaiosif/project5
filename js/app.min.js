jQuery(function(a){function b(){function b(a){var b=this,c=a.venue,d=c.categories[0],e=c.location;b.id=c.id,b.lat=e.lat,b.lng=e.lng,b.address=e.formattedAddress,b.category=d.shortName,b.icon={},b.icon.prefix=d.icon.prefix,b.icon.suffix=d.icon.suffix,b.photoCount=0,b.crtPhoto=0,b.photos=[],b.description=a.tips[0].text,b.name=c.name,b.url=c.url,b.mapMarker={},b.isCategoryVisible=ko.observable(!0),b.isQueryVisible=ko.observable(!0),b.isVisible=ko.computed(function(){return b.isCategoryVisible()&&b.isQueryVisible()})}var c=this,d=a("#map-canvas"),e=45.4960301,f=-73.5789544,g=new google.maps.LatLng(e,f),h={zoom:17,center:g,mapTypeId:google.maps.MapTypeId.ROADMAP},i=new google.maps.Map(d[0],h);google.maps.event.addDomListener(window,"resize",function(){google.maps.event.trigger(i,"resize"),i.setCenter(g)});var j=new google.maps.InfoWindow;c.errorwindow=new google.maps.InfoWindow;var k=new google.maps.Marker({map:i,position:g});k.setVisible(!1),c.categories=ko.observableArray([]),c.selectedCategories=ko.observableArray([]),c.selectedAllCategories=ko.observable(!0),c.myVenues=ko.observableArray([]),c.query=ko.observable("");var l="food",m="200",n="JI2X04M51STQLOUGVX0SWEOOSOOSHB2BEMZ0QTPM02TMJGGX",o="4W4IRQJ10E0HKFLK4TFX3KZ4Q25DHQMFKH0IQEYFRG3XDQXQ",p="https://api.foursquare.com/v2/venues/explore?client_id=";p+=n+"&client_secret=",p+=o+"&v=20150704&ll=",p+=e+",",p+=f+"&radius=",p+=m+"&section=",p+=l+"&limit=50";var q=function(b){var d="https://api.foursquare.com/v2/venues/";d+=b.id+"/photos?client_id=",d+=n+"&client_secret=",d+=o+"&v=20150704",a.ajax({url:d,success:function(a){var c=a.response.photos.count;if(c>0){b.photoCount=c;for(var d=a.response.photos.items,e=0;(10>c?c:10)>e;e++){var f={};f.prefix=d[e].prefix,f.suffix=d[e].suffix,f.width=d[e].width,f.height=d[e].height,b.photos.push(f)}}},error:function(b){var d=a.parseJSON(b.responseText);c.showErrorWindow(d.meta.errorDetail)}})},r=function(d){a.ajax({url:d,success:function(d){var e=d.response.groups[0].items;c.myVenues(ko.utils.arrayMap(e,function(a){return new b(a)}));for(var f=0;f<e.length;f++){var g=c.myVenues()[f];q(g),g.mapMarker=s(g);var h=g.category;-1===a.inArray(h,c.categories())&&c.categories.push(h)}c.categories.sort()},error:function(b){var d=a.parseJSON(b.responseText);c.showErrorWindow(d.meta.errorDetail)}})};r(p);var s=function(a){var b=new google.maps.LatLng(a.lat,a.lng),c=new google.maps.Marker({map:i,position:b,icon:a.icon.prefix+"bg_32"+a.icon.suffix});return google.maps.event.addListener(c,"click",function(){var b=x(a);j.setContent(b),j.open(i,this)}),c},t=function(a){a.isCategoryVisible(!0),a.isQueryVisible(!0),a.mapMarker.setVisible(!0)},u=function(a){a.isCategoryVisible(!1),a.mapMarker.setVisible(!1)},v=function(b){a.each(c.myVenues(),function(a,c){b?u(c):t(c)})},w=function(a,b){0===a?c.showErrorWindow("Nothing Found"):(c.errorwindow.close(),1===a&&y(c.myVenues()[b])),a>1&&j.close()},x=function(a){var b=a.photoCount,c=10>=b?b-1:9,d="<div class='info-window'>";if(b>0){var e=a.crtPhoto===c?0:a.crtPhoto;d+='<img src="'+a.photos[e].prefix,d+="300x200"+a.photos[e].suffix+'">',e++,a.crtPhoto=e}d+="<h2>"+a.name+"</h2>",d+='<div class="tip-wrapper"><div class="tip-label">Tip</div><span class="tip">'+a.description+"</span></div>";var f=a.address[0],g=a.address[1];return void 0!==f&&""!==f&&(d+='<p class="address"><em>'+f+"</em></p>"),void 0!==g&&""!==g&&(d+='<p class="address"><em>'+g+"</em></p>"),d+='<p class="category"><em>'+a.category+"</em></p>",d+=void 0!==a.url?"<a href='"+a.url+"'>"+a.url+"</a></div>":"</div>"},y=function(a){var b=a.mapMarker,c=x(a);j.setContent(c),j.open(i,b)},z=function(a){var b="<div class='error-window'><h3>"+a+"</h3>";return b+='<button onclick="VM.errorwindow.close()">Close</button></div>'};c.toggleSelectAll=function(){return v(c.selectedAllCategories()?!1:!0),c.query(""),!0},c.showVenuesWithSelectedCategories=function(){var b=c.myVenues(),d=c.selectedCategories();c.query(""),c.selectedAllCategories()&&c.selectedAllCategories(!1);for(var e=0,f=0,g=0;g<b.length;g++)a.inArray(b[g].category,d)>-1?(t(b[g]),e++,f=g):u(b[g]);w(e,f)},c.showErrorWindow=function(a){var b=z(a);c.errorwindow.setContent(b),c.errorwindow.open(i,k),j.close()},c.venueListClick=function(a){y(a)},c.showSelectedByQuery=function(){for(var a=c.query().toLowerCase(),b=0,d=0,e=c.myVenues(),f=0;f<e.length;f++)if(e[f].isCategoryVisible()){var g=e[f].name.toLowerCase();0===g.indexOf(a)?(e[f].isQueryVisible(!0),e[f].mapMarker.setVisible(!0),b++,d=f):(e[f].isQueryVisible(!1),e[f].mapMarker.setVisible(!1))}w(b,d)}}var c=new b;window.VM=c,ko.applyBindings(c)});